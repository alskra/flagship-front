include /components/table-data/table-data

mixin stage(type = 'cabinet')
  .stage(
    class=`stage--${type}`
  )&attributes(attributes)
    .stage__body
      .stage__header
        h1.h1.content.stage__title
          if type === 'cabinet'
            | Этап кабинет
          if type === 'tribune'
            | Этап “Трибуна”
        +btn({ tag: 'a', content: 'Далее', icons: ['arrow-right'] }).stage__btn-next(href="")

      if type === 'cabinet'
        .stage__main.stage-item(
          class=`stage-item--${type}`
          x-data="stageItem"
          x-bind:class="{ 'stage-item--is-started': isStarted }"
        )
          .stage__params(
            x-data="timer"
            x-id=['form-field']
          )
            label.form-label.mb-2(
              x-bind:for="$id('form-field')"
              x-show="!isStarted"
            ) Таймер (задать время)

            .stage__params-body
              div(x-show="!isStarted")
                +form-field({ tag: 'select' }).form-field--lg(
                  x-bind:id="$id('form-field')"
                  x-model.number="controlTime"
                )
                  option(value=5 * 1000) 5 сек. тест
                  option(value=5 * 60 * 1000) 5 мин.
                  option(value=15 * 60 * 1000) 15 мин.
                  option(value=30 * 60 * 1000) 30 мин.
                  option(value=45 * 60 * 1000) 45 мин.
                  option(value=60 * 60 * 1000) 1 час
              div(x-show="!isStarted")
                // `fakeSendData` фейковый метод для демонстрации (ничего не отправляет)
                +btn({ content: 'Старт' }).btn--accent.btn--lg.btn--width-full(
                  x-bind:disabled="isLoading"
                  x-on:click="isLoading = true; fakeSendData(controlTime).then(() => { isLoading = false; isStarted = true; start(); setTimeout(() => isCompleted = true, controlTime)})"
                )
              div
                +form-field().form-field.form-field--timer.form-field--lg(
                  readonly
                  x-bind:value="formatTime"
                )

          +table-data(type)

      if type === 'tribune'
        .stage__main(x-data="{ isFilled: false }")
          .stage__params(x-show="!isFilled")
            .stage__params-body
              div
                // Показать заполненную таблицу, получив предварительно данные
                +btn({content: 'Провести жеребьевку'}).btn--tertiary.btn--lg(x-on:click="isFilled = true")

          +table-data('tribune-empty')(
            x-cloak
            x-show="!isFilled"
          )
          +table-data(type)(
            x-cloak
            x-show="isFilled"
          )
